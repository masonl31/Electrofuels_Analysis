SET WASTETREATMENT  'Type of technologies for calculation of marginals' %semislash%
$if     EXIST '../data/WASTETREATMENT.inc' $INCLUDE      '../data/WASTETREATMENT.inc';
$if not EXIST '../data/WASTETREATMENT.inc' $INCLUDE '../../base/data/WASTETREATMENT.inc';
%semislash%;

SET PROCFLOWWASTETR(IPROC,PROC,FLOW,WASTETREATMENT) 'Type of technology aggrupated'%semislash%
$if     EXIST '../data/PROCFLOWWASTETR.inc' $INCLUDE      '../data/PROCFLOWWASTETR.inc';
$if not EXIST '../data/PROCFLOWWASTETR.inc' $INCLUDE '../../base/data/PROCFLOWWASTETR.inc';
%semislash%;

SET PROCWASTEINV(PROC,WASTETREATMENT) 'Type of technology aggrupated for investments'%semislash%
$if     EXIST '../data/PROCWASTEINV.inc' $INCLUDE      '../data/PROCWASTEINV.inc';
$if not EXIST '../data/PROCWASTEINV.inc' $INCLUDE '../../base/data/PROCWASTEINV.inc';
%semislash%;

Parameter WMB(Y,WASTETREATMENT,FLOWINDIC) 'Calculation of the distribution of costs in every scenario';
WMB(Y,WASTETREATMENT,FLOWINDIC)=
(SUM((IS3,T), IHOURSINST(IS3,T)*(
  SUM((IPROCFROM,PROC,FLOW,IA)$(PROCFLOWWASTETR(IPROCFROM,PROC,FLOW,WASTETREATMENT) AND (PROC_T(IPROCFROM))),
       VFLOW.L(Y,IA,IPROCFROM,PROC,FLOW,IS3,T)*SOSIBU2INDIC(Y,PROC,FLOW,FLOWINDIC)
      +VFLOW.L(Y,IA,IPROCFROM,PROC,FLOW,IS3,T)*SOSIBU2INDIC_A(IA,PROC,FLOW,FLOWINDIC)
      +VFLOW.L(Y,IA,IPROCFROM,PROC,FLOW,IS3,T)*SOSIBU2INDIC_AST(IA,PROC,FLOW,FLOWINDIC,IS3,T)
      +SUM(IR$RRRAAA(IR,IA),VFLOW.L(Y,IA,IPROCFROM,PROC,FLOW,IS3,T)*SOSIBU2INDIC_RST(IR,PROC,FLOW,FLOWINDIC,IS3,T))
    )))

+SUM((IS3,ITWWT), IHOURSINSTWWT(IS3,ITWWT)*(
  SUM((IPROCFROM,PROC,FLOW,IA)$(PROCFLOWWASTETR(IPROCFROM,PROC,FLOW,WASTETREATMENT) AND (NOT PROC_T(IPROCFROM))),
       VFLOW.L(Y,IA,IPROCFROM,PROC,FLOW,IS3,ITWWT)*SOSIBU2INDIC(Y,PROC,FLOW,FLOWINDIC)
      +VFLOW.L(Y,IA,IPROCFROM,PROC,FLOW,IS3,ITWWT)*SOSIBU2INDIC_A(IA,PROC,FLOW,FLOWINDIC)
      +VFLOW.L(Y,IA,IPROCFROM,PROC,FLOW,IS3,ITWWT)*SOSIBU2INDIC_AST(IA,PROC,FLOW,FLOWINDIC,IS3,ITWWT)
      +SUM(IR$RRRAAA(IR,IA),VFLOW.L(Y,IA,IPROCFROM,PROC,FLOW,IS3,ITWWT)*SOSIBU2INDIC_RST(IR,PROC,FLOW,FLOWINDIC,IS3,ITWWT))
    )))

-SUM((IS3,T), IHOURSINST(IS3,T)*(
  SUM((IPROCTO,PROC,FLOW,IA)$(PROCFLOWWASTETR(IPROCTO,PROC,FLOW,WASTETREATMENT) AND (PROC_T(IPROCTO))),
       VFLOW.L(Y,IA,PROC,IPROCTO,FLOW,IS3,T)*SOSIBU2INDIC(Y,PROC,FLOW,FLOWINDIC)
      +VFLOW.L(Y,IA,PROC,IPROCTO,FLOW,IS3,T)*SOSIBU2INDIC_A(IA,PROC,FLOW,FLOWINDIC)
      +VFLOW.L(Y,IA,PROC,IPROCTO,FLOW,IS3,T)*SOSIBU2INDIC_AST(IA,PROC,FLOW,FLOWINDIC,IS3,T)
      +SUM(IR$RRRAAA(IR,IA),VFLOW.L(Y,IA,PROC,IPROCTO,FLOW,IS3,T)*SOSIBU2INDIC_RST(IR,PROC,FLOW,FLOWINDIC,IS3,T))
    )))

-SUM((IS3,ITWWT), IHOURSINSTWWT(IS3,ITWWT)*(
  SUM((IPROCTO,PROC,FLOW,IA)$(PROCFLOWWASTETR(IPROCTO,PROC,FLOW,WASTETREATMENT) AND (NOT PROC_T(IPROCTO))),
       VFLOW.L(Y,IA,PROC,IPROCTO,FLOW,IS3,ITWWT)*SOSIBU2INDIC(Y,PROC,FLOW,FLOWINDIC)
      +VFLOW.L(Y,IA,PROC,IPROCTO,FLOW,IS3,ITWWT)*SOSIBU2INDIC_A(IA,PROC,FLOW,FLOWINDIC)
      +VFLOW.L(Y,IA,PROC,IPROCTO,FLOW,IS3,ITWWT)*SOSIBU2INDIC_AST(IA,PROC,FLOW,FLOWINDIC,IS3,ITWWT)
      +SUM(IR$RRRAAA(IR,IA),VFLOW.L(Y,IA,PROC,IPROCTO,FLOW,IS3,ITWWT)*SOSIBU2INDIC_RST(IR,PROC,FLOW,FLOWINDIC,IS3,ITWWT))
    )))

- ((SUM((IA,IPROCFROM)$(IAPROCKAPNEW(Y,IA,IPROCFROM) AND PROCWASTEINV(IPROCFROM,WASTETREATMENT)),INDICLIMGOAL(FLOWINDIC,'INDICWEIGHT')*IOF1000000*PROCDATA(IPROCFROM,'PROCINVCOST')*VPROCKAPNEW.L(Y,IA,IPROCFROM)*(RateOfReturn/(1-((1+RateOfReturn)**(-PROCDATA(IPROCFROM,'PROCLIFETIME')))))))$FLOWINDIC('OPERATIONCOST'))
 )
/(SUM(IA,SOSIBUBOUND(IA,'HouseHoldWasteGen','RESIDUALWASTEHH','ILOUPFX_FX')*PROCINOUTFLOW(IA,'SourceSegregOF_No','RESIDUALWASTEHH_SEP_PEOPLE_3','RESIDUALWASTEHH_SEP_TON_3','IONEONE')))


;

WMB(Y,"Transport",FLOWINDIC)=(SUM((IS3,T), IHOURSINST(IS3,T)*(
 + SUM((IAE,IAI,PROCEXIM,IFLOWEXIM)$(TRANSDIST(PROCEXIM,IAE,IAI) AND (PROC_T(PROCEXIM)) AND PROCINOUTFLOW(IAE,PROCEXIM,IFLOWEXIM,IFLOWEXIM,"IONEONE")), VFLOWTRANS.L(Y,IAE,IAI,PROCEXIM,IFLOWEXIM,IS3,T)$(NOT TRANSFLOWMAX(Y,IAE,IAI,PROCEXIM,IFLOWEXIM))*(TRANSDIST(PROCEXIM,IAE,IAI)*TRANSCOST(Y,'TCDMONEYKMTON','ITRANSDWDISTWEIGHT',PROCEXIM,FLOWINDIC)+TRANSCOST(Y,'TCDMONEYTON','ITRANSDWWEIGHT',PROCEXIM,FLOWINDIC)))
  ))+SUM((IS3,ITWWT), IHOURSINSTWWT(IS3,ITWWT)*(
 + SUM((IAE,IAI,PROCEXIM,IFLOWEXIM)$(TRANSDIST(PROCEXIM,IAE,IAI) AND (NOT PROC_T(PROCEXIM)) AND PROCINOUTFLOW(IAE,PROCEXIM,IFLOWEXIM,IFLOWEXIM,"IONEONE")), VFLOWTRANS.L(Y,IAE,IAI,PROCEXIM,IFLOWEXIM,IS3,ITWWT)$(NOT TRANSFLOWMAX(Y,IAE,IAI,PROCEXIM,IFLOWEXIM))*(TRANSDIST(PROCEXIM,IAE,IAI)*TRANSCOST(Y,'TCDMONEYKMTON','ITRANSDWDISTWEIGHT',PROCEXIM,FLOWINDIC)+TRANSCOST(Y,'TCDMONEYTON','ITRANSDWWEIGHT',PROCEXIM,FLOWINDIC)))
)))/(SUM(IA,SOSIBUBOUND(IA,'HouseHoldWasteGen','RESIDUALWASTEHH','ILOUPFX_FX')*PROCINOUTFLOW(IA,'SourceSegregOF_No','RESIDUALWASTEHH_SEP_PEOPLE_3','RESIDUALWASTEHH_SEP_TON_3','IONEONE')))
;

Parameter TRANSPORTDISTANCE(Y,FLOW) 'Transport distance per type of fuel (km)';
TRANSPORTDISTANCE(Y,IFLOWEXIM)=

(SUM((IS3,T), IHOURSINST(IS3,T)*(
 + SUM((IAE,IAI,PROCEXIM)$(TRANSDIST(PROCEXIM,IAE,IAI) AND (PROC_T(PROCEXIM)) AND PROCINOUTFLOW(IAE,PROCEXIM,IFLOWEXIM,IFLOWEXIM,"IONEONE")), (VFLOWTRANS.L(Y,IAE,IAI,PROCEXIM,IFLOWEXIM,IS3,T))$(NOT TRANSFLOWMAX(Y,IAE,IAI,PROCEXIM,IFLOWEXIM))*(TRANSDIST(PROCEXIM,IAE,IAI)))
))

+SUM((IS3,ITWWT), IHOURSINSTWWT(IS3,ITWWT)*(
 + SUM((IAE,IAI,PROCEXIM)$(TRANSDIST(PROCEXIM,IAE,IAI) AND (NOT PROC_T(PROCEXIM)) AND PROCINOUTFLOW(IAE,PROCEXIM,IFLOWEXIM,IFLOWEXIM,"IONEONE")), (VFLOWTRANS.L(Y,IAE,IAI,PROCEXIM,IFLOWEXIM,IS3,ITWWT))$(NOT TRANSFLOWMAX(Y,IAE,IAI,PROCEXIM,IFLOWEXIM))*(TRANSDIST(PROCEXIM,IAE,IAI)))
))
)
;


WMB(Y,"Import of Waste",FLOWINDIC)=SUM((IS3,ITWWT), IHOURSINSTWWT(IS3,ITWWT)*(VFLOWSOURCE.L(Y,'UK_AAA','RDF_low-CV_Source','RDF_LOW-CV',IS3,ITWWT)*SOSIBU2INDIC(Y,'RDF_low-CV_Source','RDF_LOW-CV',FLOWINDIC)
+VFLOWSOURCE.L(Y,'UK_AAA','RDF_high-CV_Source','RDF_HIGH-CV',IS3,ITWWT)*SOSIBU2INDIC(Y,'RDF_high-CV_Source','RDF_HIGH-CV',FLOWINDIC)))
/(SUM(IA,SOSIBUBOUND(IA,'HouseHoldWasteGen','RESIDUALWASTEHH','ILOUPFX_FX')*PROCINOUTFLOW(IA,'SourceSegregOF_No','RESIDUALWASTEHH_SEP_PEOPLE_3','RESIDUALWASTEHH_SEP_TON_3','IONEONE')))
;


PARAMETER WASTEINCINERATION(Y,WASTETREATMENT,SSS,TTT) 'Tons of MSW incineration';
WASTEINCINERATION(Y,"MSW CHP Large",IS3,T)=SUM(IA,VFLOW.L(Y,IA,'SUM_MSW_charact_chp','MSW_chp_large','MSW_FUELCHP_LARGE_TON',IS3,T));
WASTEINCINERATION(Y,"MSW CHP Medium",IS3,T)=SUM(IA,VFLOW.L(Y,IA,'SUM_MSW_charact_chp','MSW_chp_medium','MSW_FUELCHP_MEDIUM_TON',IS3,T));
WASTEINCINERATION(Y,"MSW CHP Small",IS3,T)=SUM(IA,VFLOW.L(Y,IA,'SUM_MSW_charact_chp','MSW_chp_small','MSW_FUELCHP_SMALL_TON',IS3,T));
WASTEINCINERATION(Y,"MSW Boiler",IS3,T)=SUM(IA,VFLOW.L(Y,IA,'SUM_MSW_charact_ho','MSW_ho','MSW_FUELHO_TON',IS3,T));
WASTEINCINERATION(Y,"RDF CHP",IS3,T)=SUM(IA,VFLOW.L(Y,IA,'SUM_RDF_charact_chp','RDF_chp','RDF_FUELCHP_TON',IS3,T));
WASTEINCINERATION(Y,"RDF Boiler",IS3,T)=SUM(IA,VFLOW.L(Y,IA,'SUM_RDF_charact_ho','RDF_ho','RDF_FUELHO_TON',IS3,T));

PARAMETER HEATGENERATION(Y,AAA,PROC,SSS,TTT)  'MW of Heat';
HEATGENERATION(Y,IA,PROC,IS3,T)$(NOT PROCSINK(PROC))=VFLOW.L(Y,IA,PROC,'HeatgenfromBurn','HEATFLOW',IS3,T)+VFLOW.L(Y,IA,PROC,'ProcHeatGenLinkStorage','HEATFLOW',IS3,T);
HEATGENERATION(Y,IA,PROCSINK,IS3,T)=VFLOWSINK.L(Y,IA,PROCSINK,'HEATCOOLFLOW',IS3,T);

PARAMETER UTILIZATION_RATE(Y,AAA,PROC);
UTILIZATION_RATE(Y,IA,PROC)$(VPROCKAPNEW.L(Y,IA,PROC) GT 0.05)=(SUM((IPROCFROM,FLOW,S,T),(VFLOW.L(Y,IA,IPROCFROM,PROC,FLOW,S,T)*IHOURSINST(S,T))$(PROCKAPDATA(PROC,FLOW,'IFLOWINOUT_IN'))))/(VPROCKAPNEW.L(Y,IA,PROC)*8760);

PARAMETER HEATING_VALUE(Y,AAA,PROC);
HEATING_VALUE(Y,IA,'MSW_chp_large')$(VPROCKAPNEW.L(Y,IA,'MSW_chp_large') GT 0.1)=(SUM((S,T),VFLOW.L(Y,IA,'SUM_MSW_charact_chp','MSW_chp_large','MSW_FUELCHP_LARGE_GJ',S,T)*IHOURSINST(S,T)))/(VPROCKAPNEW.L(Y,IA,'MSW_chp_large')*8760);
HEATING_VALUE(Y,IA,'MSW_chp_medium')$(VPROCKAPNEW.L(Y,IA,'MSW_chp_medium') GT 0.1)=(SUM((S,T),VFLOW.L(Y,IA,'SUM_MSW_charact_chp','MSW_chp_medium','MSW_FUELCHP_MEDIUM_GJ',S,T)*IHOURSINST(S,T)))/(VPROCKAPNEW.L(Y,IA,'MSW_chp_medium')*8760);
HEATING_VALUE(Y,IA,'MSW_chp_small')$(VPROCKAPNEW.L(Y,IA,'MSW_chp_small') GT 0.1)=(SUM((S,T),VFLOW.L(Y,IA,'SUM_MSW_charact_chp','MSW_chp_small','MSW_FUELCHP_SMALL_GJ',S,T)*IHOURSINST(S,T)))/(VPROCKAPNEW.L(Y,IA,'MSW_chp_small')*8760);
HEATING_VALUE(Y,IA,'MSW_ho')$(VPROCKAPNEW.L(Y,IA,'MSW_ho') GT 0.1)=(SUM((S,T),VFLOW.L(Y,IA,'SUM_MSW_charact_ho','MSW_ho','MSW_FUELHO_GJ',S,T)*IHOURSINST(S,T)))/(VPROCKAPNEW.L(Y,IA,'MSW_ho')*8760);

PARAMETER TOTALWASTE(Y);
TOTALWASTE(Y)=SUM((IA,S,T),(VFLOW.L(Y,IA,'SUM_MSW_charact_chp','MSW_chp_large','MSW_FUELCHP_LARGE_GJ',S,T)+VFLOW.L(Y,IA,'SUM_MSW_charact_chp','MSW_chp_medium','MSW_FUELCHP_MEDIUM_GJ',S,T)
+VFLOW.L(Y,IA,'SUM_MSW_charact_chp','MSW_chp_small','MSW_FUELCHP_SMALL_GJ',S,T)+VFLOW.L(Y,IA,'SUM_MSW_charact_ho','MSW_ho','MSW_FUELHO_GJ',S,T))*IHOURSINST(S,T));
